<!DOCTYPE html>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<title>EF Core &#x2d; Database schema changes | makolyte</title>
	<style>img:is([sizes="auto" i], [sizes^="auto," i]) { contain-intrinsic-size: 3000px 1500px }</style>
	<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The SEO Framework by Sybre Waaijer -->
<meta name="robots" content="max-snippet:-1,max-image-preview:standard,max-video-preview:-1">
<link rel="canonical" href="/ef-core-database-schema-changes/">
<meta name="description" content="Shows multiple examples of the database schema change process, including error scenarios where you need to customize the migration">
<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="makolyte">
<meta property="og:title" content="EF Core &#x2d; Database schema changes | makolyte">
<meta property="og:description" content="Shows multiple examples of the database schema change process, including error scenarios where you need to customize the migration">
<meta property="og:url" content="/ef-core-database-schema-changes/">
<meta property="og:image" content="/wp-content/uploads/2021/03/database-schema-change-process-in-ef-core.png">
<meta property="og:image:width" content="774">
<meta property="og:image:height" content="618">
<meta property="article:published_time" content="2021-03-19T11:45:43+00:00">
<meta property="article:modified_time" content="2025-01-26T14:52:44+00:00">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@makolyte">
<meta name="twitter:title" content="EF Core &#x2d; Database schema changes | makolyte">
<meta name="twitter:description" content="Shows multiple examples of the database schema change process, including error scenarios where you need to customize the migration">
<meta name="twitter:image" content="/wp-content/uploads/2021/03/database-schema-change-process-in-ef-core.png">
<script type="application/ld+json">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"/#/schema/WebSite","url":"/","name":"makolyte","description":"Solve real coding problems","inLanguage":"en-US","potentialAction":{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"/search/{search_term_string}/"},"query-input":"required name=search_term_string"},"publisher":{"@type":"Organization","@id":"/#/schema/Organization","name":"makolyte","url":"/","sameAs":"https://twitter.com/makolyte","logo":{"@type":"ImageObject","url":"/wp-content/uploads/2019/12/cropped-makolyte-icon-512-e1575418903583-4.png","contentUrl":"/wp-content/uploads/2019/12/cropped-makolyte-icon-512-e1575418903583-4.png","width":332,"height":318}}},{"@type":"WebPage","@id":"/ef-core-database-schema-changes/","url":"/ef-core-database-schema-changes/","name":"EF Core - Database schema changes | makolyte","description":"Shows multiple examples of the database schema change process, including error scenarios where you need to customize the migration","inLanguage":"en-US","isPartOf":{"@id":"/#/schema/WebSite"},"breadcrumb":{"@type":"BreadcrumbList","@id":"/#/schema/BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":"/","name":"makolyte"},{"@type":"ListItem","position":2,"item":"/category/csharp/","name":"C#"},{"@type":"ListItem","position":3,"name":"EF Core - Database schema changes"}]},"potentialAction":{"@type":"ReadAction","target":"/ef-core-database-schema-changes/"},"datePublished":"2021-03-19T11:45:43+00:00","dateModified":"2025-01-26T14:52:44+00:00","author":{"@type":"Person","@id":"/#/schema/Person/e99fbed30936ed203340e328108b95ee","name":"Mak"}}]}</script>


<link rel="alternate" type="application/rss+xml" title="makolyte &raquo; Feed" href="/feed/">
<link rel="alternate" type="application/rss+xml" title="makolyte &raquo; Comments Feed" href="/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="makolyte &raquo; EF Core &#8211; Database schema changes Comments Feed" href="/ef-core-database-schema-changes/feed/">
<script>
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.7.2"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"üè≥Ô∏è‚Äç‚ößÔ∏è","üè≥Ô∏è‚Äã‚ößÔ∏è")?!1:!n(e,"üá∫üá≥","üá∫‚Äãüá≥")&&!n(e,"üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø","üè¥‚ÄãÛ†Åß‚ÄãÛ†Å¢‚ÄãÛ†Å•‚ÄãÛ†ÅÆ‚ÄãÛ†Åß‚ÄãÛ†Åø");case"emoji":return!n(e,"üê¶‚Äç‚¨õ","üê¶‚Äã‚¨õ")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
</script>
<style id="wp-emoji-styles-inline-css">img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}</style>
<link rel="stylesheet" id="wp-block-library-css" href="/wp-includes/css/dist/block-library/style.min.css?ver=6.7.2" media="all">
<link rel="stylesheet" id="syntax-highlighting-code-block-theme-css" href="/wp-content/plugins/syntax-highlighting-code-block/vendor/scrivo/highlight-php/styles/vs2015.css?ver=1.5.1" media="all">
<style id="syntax-highlighting-code-block-inline-css">.wp-block-code {
	border: 0;
	padding: 0;
	-webkit-text-size-adjust: 100%;
	text-size-adjust: 100%;
}

.wp-block-code > span {
	display: block;
	overflow: auto;
}

.shcb-language {
	border: 0;
	clip: rect(1px, 1px, 1px, 1px);
	-webkit-clip-path: inset(50%);
	clip-path: inset(50%);
	height: 1px;
	margin: -1px;
	overflow: hidden;
	padding: 0;
	position: absolute;
	width: 1px;
	word-wrap: normal;
	word-break: normal;
}

.hljs {
	box-sizing: border-box;
}

.hljs.shcb-code-table {
	display: table;
	width: 100%;
}

.hljs.shcb-code-table > .shcb-loc {
	color: inherit;
	display: table-row;
	width: 100%;
}

.hljs.shcb-code-table .shcb-loc > span {
	display: table-cell;
}

.wp-block-code code.hljs:not(.shcb-wrap-lines) {
	white-space: pre;
}

.wp-block-code code.hljs.shcb-wrap-lines {
	white-space: pre-wrap;
}

.hljs.shcb-line-numbers {
	border-spacing: 0;
	counter-reset: line;
}

.hljs.shcb-line-numbers > .shcb-loc {
	counter-increment: line;
}

.hljs.shcb-line-numbers .shcb-loc > span {
	padding-left: 0.75em;
}

.hljs.shcb-line-numbers .shcb-loc::before {
	border-right: 1px solid #ddd;
	content: counter(line);
	display: table-cell;
	padding: 0 0.75em;
	text-align: right;
	-webkit-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
	user-select: none;
	white-space: nowrap;
	width: 1%;
}

.hljs > mark.shcb-loc { background-color: #3F3F3F; }</style>
<style id="classic-theme-styles-inline-css">/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}</style>
<style id="global-styles-inline-css">:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--color--contrast: var(--contrast);--wp--preset--color--contrast-2: var(--contrast-2);--wp--preset--color--contrast-3: var(--contrast-3);--wp--preset--color--base: var(--base);--wp--preset--color--base-2: var(--base-2);--wp--preset--color--base-3: var(--base-3);--wp--preset--color--accent: var(--accent);--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}</style>
<link rel="stylesheet" id="ez-toc-css" href="/wp-content/plugins/etoc-makolyte-mod/assets/css/screen.min.css?ver=2.0.17.1" media="all">
<style id="ez-toc-inline-css">div#ez-toc-container p.ez-toc-title {font-size: 120%;}div#ez-toc-container p.ez-toc-title {font-weight: 500;}div#ez-toc-container ul li {font-size: 95%;}</style>
<link rel="stylesheet" id="related-frontend-css-css" href="/wp-content/plugins/related/css/frontend-style.css?ver=3.5.0" media="all">
<link rel="stylesheet" id="generate-style-css" href="/wp-content/themes/generatepress/assets/css/all.min.css?ver=3.3.1" media="all">
<style id="generate-style-inline-css">body{background-color:#ffffff;color:#000000;}a{color:#1e73be;}a:hover, a:focus, a:active{color:#000000;}body .grid-container{max-width:1400px;}.wp-block-group__inner-container{max-width:1400px;margin-left:auto;margin-right:auto;}.navigation-search{position:absolute;left:-99999px;pointer-events:none;visibility:hidden;z-index:20;width:100%;top:0;transition:opacity 100ms ease-in-out;opacity:0;}.navigation-search.nav-search-active{left:0;right:0;pointer-events:auto;visibility:visible;opacity:1;}.navigation-search input[type="search"]{outline:0;border:0;vertical-align:bottom;line-height:1;opacity:0.9;width:100%;z-index:20;border-radius:0;-webkit-appearance:none;height:60px;}.navigation-search input::-ms-clear{display:none;width:0;height:0;}.navigation-search input::-ms-reveal{display:none;width:0;height:0;}.navigation-search input::-webkit-search-decoration, .navigation-search input::-webkit-search-cancel-button, .navigation-search input::-webkit-search-results-button, .navigation-search input::-webkit-search-results-decoration{display:none;}.main-navigation li.search-item{z-index:21;}li.search-item.active{transition:opacity 100ms ease-in-out;}.nav-left-sidebar .main-navigation li.search-item.active,.nav-right-sidebar .main-navigation li.search-item.active{width:auto;display:inline-block;float:right;}.gen-sidebar-nav .navigation-search{top:auto;bottom:0;}:root{--contrast:#222222;--contrast-2:#575760;--contrast-3:#b2b2be;--base:#f0f0f0;--base-2:#f7f8f9;--base-3:#ffffff;--accent:#1e73be;}:root .has-contrast-color{color:var(--contrast);}:root .has-contrast-background-color{background-color:var(--contrast);}:root .has-contrast-2-color{color:var(--contrast-2);}:root .has-contrast-2-background-color{background-color:var(--contrast-2);}:root .has-contrast-3-color{color:var(--contrast-3);}:root .has-contrast-3-background-color{background-color:var(--contrast-3);}:root .has-base-color{color:var(--base);}:root .has-base-background-color{background-color:var(--base);}:root .has-base-2-color{color:var(--base-2);}:root .has-base-2-background-color{background-color:var(--base-2);}:root .has-base-3-color{color:var(--base-3);}:root .has-base-3-background-color{background-color:var(--base-3);}:root .has-accent-color{color:var(--accent);}:root .has-accent-background-color{background-color:var(--accent);}body, button, input, select, textarea{font-family:-apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";}body{line-height:1.5;}.entry-content > [class*="wp-block-"]:not(:last-child):not(.wp-block-heading){margin-bottom:1.5em;}.main-navigation .main-nav ul ul li a{font-size:14px;}.sidebar .widget, .footer-widgets .widget{font-size:17px;}h1{font-weight:300;font-size:40px;}h2{font-weight:300;font-size:30px;}h3{font-size:20px;}h4{font-size:inherit;}h5{font-size:inherit;}@media (max-width:768px){.main-title{font-size:30px;}h1{font-size:30px;}h2{font-size:25px;}}.top-bar{background-color:#636363;color:#ffffff;}.top-bar a{color:#ffffff;}.top-bar a:hover{color:#303030;}.site-header{background-color:#ffffff;color:#3a3a3a;}.site-header a{color:#3a3a3a;}.main-title a,.main-title a:hover{color:#222222;}.site-description{color:#757575;}.main-navigation,.main-navigation ul ul{background-color:#222222;}.main-navigation .main-nav ul li a, .main-navigation .menu-toggle, .main-navigation .menu-bar-items{color:#ffffff;}.main-navigation .main-nav ul li:not([class*="current-menu-"]):hover > a, .main-navigation .main-nav ul li:not([class*="current-menu-"]):focus > a, .main-navigation .main-nav ul li.sfHover:not([class*="current-menu-"]) > a, .main-navigation .menu-bar-item:hover > a, .main-navigation .menu-bar-item.sfHover > a{color:#ffffff;background-color:#3f3f3f;}button.menu-toggle:hover,button.menu-toggle:focus,.main-navigation .mobile-bar-items a,.main-navigation .mobile-bar-items a:hover,.main-navigation .mobile-bar-items a:focus{color:#ffffff;}.main-navigation .main-nav ul li[class*="current-menu-"] > a{color:#ffffff;background-color:#3f3f3f;}.navigation-search input[type="search"],.navigation-search input[type="search"]:active, .navigation-search input[type="search"]:focus, .main-navigation .main-nav ul li.search-item.active > a, .main-navigation .menu-bar-items .search-item.active > a{color:#ffffff;background-color:#3f3f3f;}.main-navigation ul ul{background-color:#3f3f3f;}.main-navigation .main-nav ul ul li a{color:#ffffff;}.main-navigation .main-nav ul ul li:not([class*="current-menu-"]):hover > a,.main-navigation .main-nav ul ul li:not([class*="current-menu-"]):focus > a, .main-navigation .main-nav ul ul li.sfHover:not([class*="current-menu-"]) > a{color:#ffffff;background-color:#4f4f4f;}.main-navigation .main-nav ul ul li[class*="current-menu-"] > a{color:#ffffff;background-color:#4f4f4f;}.separate-containers .inside-article, .separate-containers .comments-area, .separate-containers .page-header, .one-container .container, .separate-containers .paging-navigation, .inside-page-header{background-color:#ffffff;}.entry-meta{color:#595959;}.entry-meta a{color:#595959;}.entry-meta a:hover{color:#1e73be;}.sidebar .widget{background-color:#ffffff;}.sidebar .widget .widget-title{color:#000000;}.footer-widgets{background-color:#ffffff;}.footer-widgets .widget-title{color:#000000;}.site-info{color:#ffffff;background-color:#222222;}.site-info a{color:#ffffff;}.site-info a:hover{color:#606060;}.footer-bar .widget_nav_menu .current-menu-item a{color:#606060;}input[type="text"],input[type="email"],input[type="url"],input[type="password"],input[type="search"],input[type="tel"],input[type="number"],textarea,select{color:#666666;background-color:#fafafa;border-color:#cccccc;}input[type="text"]:focus,input[type="email"]:focus,input[type="url"]:focus,input[type="password"]:focus,input[type="search"]:focus,input[type="tel"]:focus,input[type="number"]:focus,textarea:focus,select:focus{color:#666666;background-color:#ffffff;border-color:#bfbfbf;}button,html input[type="button"],input[type="reset"],input[type="submit"],a.button,a.wp-block-button__link:not(.has-background){color:#ffffff;background-color:#666666;}button:hover,html input[type="button"]:hover,input[type="reset"]:hover,input[type="submit"]:hover,a.button:hover,button:focus,html input[type="button"]:focus,input[type="reset"]:focus,input[type="submit"]:focus,a.button:focus,a.wp-block-button__link:not(.has-background):active,a.wp-block-button__link:not(.has-background):focus,a.wp-block-button__link:not(.has-background):hover{color:#ffffff;background-color:#3f3f3f;}a.generate-back-to-top{background-color:rgba( 0,0,0,0.4 );color:#ffffff;}a.generate-back-to-top:hover,a.generate-back-to-top:focus{background-color:rgba( 0,0,0,0.6 );color:#ffffff;}:root{--gp-search-modal-bg-color:var(--base-3);--gp-search-modal-text-color:var(--contrast);--gp-search-modal-overlay-bg-color:rgba(0,0,0,0.2);}@media (max-width:768px){.main-navigation .menu-bar-item:hover > a, .main-navigation .menu-bar-item.sfHover > a{background:none;color:#ffffff;}}.inside-top-bar{padding:10px;}.site-main .wp-block-group__inner-container{padding:40px;}.entry-content .alignwide, body:not(.no-sidebar) .entry-content .alignfull{margin-left:-40px;width:calc(100% + 80px);max-width:calc(100% + 80px);}.container.grid-container{max-width:1480px;}.rtl .menu-item-has-children .dropdown-menu-toggle{padding-left:20px;}.rtl .main-navigation .main-nav ul li.menu-item-has-children > a{padding-right:20px;}.site-info{padding:20px;}@media (max-width:768px){.separate-containers .inside-article, .separate-containers .comments-area, .separate-containers .page-header, .separate-containers .paging-navigation, .one-container .site-content, .inside-page-header{padding:30px;}.site-main .wp-block-group__inner-container{padding:30px;}.site-info{padding-right:10px;padding-left:10px;}.entry-content .alignwide, body:not(.no-sidebar) .entry-content .alignfull{margin-left:-30px;width:calc(100% + 60px);max-width:calc(100% + 60px);}}.one-container .sidebar .widget{padding:0px;}/* End cached CSS */@media (max-width:768px){.main-navigation .menu-toggle,.main-navigation .mobile-bar-items,.sidebar-nav-mobile:not(#sticky-placeholder){display:block;}.main-navigation ul,.gen-sidebar-nav{display:none;}[class*="nav-float-"] .site-header .inside-header > *{float:none;clear:both;}}</style>
<link rel="https://api.w.org/" href="/wp-json/">
<link rel="alternate" title="JSON" type="application/json" href="/wp-json/wp/v2/posts/4463">
<script defer src="https://cloud.umami.is/script.js" data-website-id="b31b5afd-a6bb-4cbc-ad87-f7d58d45fac2"></script>
    <link rel="icon" href="/wp-content/uploads/2019/12/cropped-makolyte-icon-512-e1575418903583-1-120x120.png" sizes="32x32">
<link rel="icon" href="/wp-content/uploads/2019/12/cropped-makolyte-icon-512-e1575418903583-1-300x300.png" sizes="192x192">
<link rel="apple-touch-icon" href="/wp-content/uploads/2019/12/cropped-makolyte-icon-512-e1575418903583-1-300x300.png">
<meta name="msapplication-TileImage" content="/wp-content/uploads/2019/12/cropped-makolyte-icon-512-e1575418903583-1-300x300.png">
		<style id="wp-custom-css">.site-header .header-image {
height: 128px;
width: 91px;
}

.yarpp-related a{
    font-weight:normal !important;
}

.home-column-title {
       word-wrap: normal;
       word-break: keep-all;
	     padding-right: 4em !important;
}

.posted-on .updated {
    display: inline-block;
}

.posted-on .updated + .entry-date {
    display: none;
}

.posted-on .updated:before {
    content: "Last updated on ";
}
.posted-on .published:before {
    content: "Last updated on ";
}

.mako-grid 
{
	display:grid;
	grid-template-columns: 1fr 1fr;
	gap: 34px;
}
@media screen and (max-width: 768px)
{
	.mako-grid{
		display:grid;
		grid-template-columns: 1fr;
		gap: 34px;
	}
}

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  background: #1E1E1E;
  color: #DCDCDC;
}

.hljs-keyword,
.hljs-literal,
.hljs-symbol,
.hljs-name {
  color: #569CD6;
}
.hljs-link {
  color: #569CD6;
  text-decoration: underline;
}

.hljs-built_in,
.hljs-type {
  color: #4EC9B0;
}

.hljs-number,
.hljs-class {
  color: #B8D7A3;
}

.hljs-string,
.hljs-meta-string {
  color: #D69D85;
}

.hljs-regexp,
.hljs-template-tag {
  color: #9A5334;
}

.hljs-subst,
.hljs-function,
.hljs-title,
.hljs-params,
.hljs-formula {
  color: #DCDCDC;
}

.hljs-comment,
.hljs-quote {
  color: #57A64A;
  font-style: italic;
}

.hljs-doctag {
  color: #608B4E;
}

.hljs-meta,
.hljs-meta-keyword,
.hljs-tag {
  color: #9B9B9B;
}

.hljs-variable,
.hljs-template-variable {
  color: #BD63C5;
}

.hljs-attr,
.hljs-attribute,
.hljs-builtin-name {
  color: #9CDCFE;
}

.hljs-section {
  color: gold;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}

.hljs-bullet,
.hljs-selector-tag,
.hljs-selector-id,
.hljs-selector-class,
.hljs-selector-attr,
.hljs-selector-pseudo {
  color: #D7BA7D;
}

.hljs-addition {
  background-color: #144212;
  display: inline-block;
  width: 100%;
}

.hljs-deletion {
  background-color: #600;
  display: inline-block;
  width: 100%;
}</style>
		</head>

<body class="post-template-default single single-post postid-4463 single-format-standard wp-custom-logo wp-embed-responsive right-sidebar nav-float-right one-container fluid-header active-footer-widgets-3 nav-search-enabled header-aligned-left dropdown-hover" itemtype="https://schema.org/Blog" itemscope>
	<a class="screen-reader-text skip-link" href="#content" title="Skip to content">Skip to content</a>		<header class="site-header" id="masthead" aria-label="Site" itemtype="https://schema.org/WPHeader" itemscope>
			<div class="inside-header grid-container grid-parent">
				<div class="site-branding-container">
<div class="site-logo">
					<a href="/" rel="home">
						<img class="header-image is-logo-image" alt="makolyte" src="/wp-content/uploads/2019/12/makolyte-icon-128-e1575419011285.png">
					</a>
				</div>
<div class="site-branding">
						<p class="main-title" itemprop="headline">
					<a href="/" rel="home">
						makolyte
					</a>
				</p>
						<p class="site-description" itemprop="description">
					Solve real coding problems
				</p>
					</div>
</div>		<nav class="main-navigation grid-container grid-parent sub-menu-right" id="site-navigation" aria-label="Primary" itemtype="https://schema.org/SiteNavigationElement" itemscope>
			<div class="inside-navigation grid-container grid-parent">
						<button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">
					<span class="gp-icon icon-menu-bars"><svg viewbox="0 0 512 512" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M0 96c0-13.255 10.745-24 24-24h464c13.255 0 24 10.745 24 24s-10.745 24-24 24H24c-13.255 0-24-10.745-24-24zm0 160c0-13.255 10.745-24 24-24h464c13.255 0 24 10.745 24 24s-10.745 24-24 24H24c-13.255 0-24-10.745-24-24zm0 160c0-13.255 10.745-24 24-24h464c13.255 0 24 10.745 24 24s-10.745 24-24 24H24c-13.255 0-24-10.745-24-24z"></path></svg><svg viewbox="0 0 512 512" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M71.029 71.029c9.373-9.372 24.569-9.372 33.942 0L256 222.059l151.029-151.03c9.373-9.372 24.569-9.372 33.942 0 9.372 9.373 9.372 24.569 0 33.942L289.941 256l151.03 151.029c9.372 9.373 9.372 24.569 0 33.942-9.373 9.372-24.569 9.372-33.942 0L256 289.941l-151.029 151.03c-9.373 9.372-24.569 9.372-33.942 0-9.372-9.373-9.372-24.569 0-33.942L222.059 256 71.029 104.971c-9.372-9.373-9.372-24.569 0-33.942z"></path></svg></span><span class="mobile-menu">Menu</span>				</button>
				<div id="primary-menu" class="main-nav"><ul id="menu-primary-menu" class=" menu sf-menu">
<li id="menu-item-15" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15"><a href="/about/">About</a></li>
<li id="menu-item-305" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-305"><a href="/category/csharp/">C#</a></li>
<li id="menu-item-185" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-185"><a href="/category/sql/">SQL</a></li>

</ul></div>			</div>
		</nav>
					</div>
		</header>
		
	<div class="site grid-container container hfeed grid-parent" id="page">
				<div class="site-content" id="content">
			
	<div class="content-area grid-parent mobile-grid-100 grid-75 tablet-grid-75" id="primary">
		<main class="site-main" id="main">
			
<article id="post-4463" class="post-4463 post type-post status-publish format-standard hentry category-csharp tag-dbcontext tag-dbset tag-efcore" itemtype="https://schema.org/CreativeWork" itemscope>
	<div class="inside-article">
					<header class="entry-header" aria-label="Content">
				<h1 class="entry-title" itemprop="headline">EF Core &#8211; Database schema changes</h1>		<div class="entry-meta">
			<span class="posted-on"><time class="updated" datetime="2025-01-26T09:52:44-05:00" itemprop="dateModified">01/26/2025</time><time class="entry-date published" datetime="2021-03-19T07:45:43-04:00" itemprop="datePublished">03/19/2021</time></span> <span class="byline">by <span class="author vcard" itemprop="author" itemtype="https://schema.org/Person" itemscope><a class="url fn n" href="/about/" title="Get to know more about Mak" rel="author" itemprop="url"><span class="author-name" itemprop="name">Mak</span></a></span></span> 		</div>
					</header>
			
		<div class="entry-content" itemprop="text">
			
<p>Anytime you change the definition of the database &#8211; from renaming a column to creating a table &#8211; it&#8217;s referred to as a database schema change. With EF Core, you deal with database schema changes by using migrations. </p>



<p>When you first <a href="/ef-core-how-to-create-a-database-and-a-table/" data-type="post" data-id="4397">create the database</a> with EF Core, you create a migration that contains the initial definition of the database. As you make schema changes, you add new migrations and apply them on top of the existing migrations.</p>



<p>In this article, I&#8217;ll show examples of going through the database schema change process in a few different scenarios, including error scenarios that require customizing the migration.</p>



<p><em>Note: I&#8217;ll be using the dotnet ef tool for handling migrations. I&#8217;ll use the command line &#8211; dotnet ef database update &#8211; for applying the migration. I&#8217;m working in a dev environment, so this is for simplicity and brevity.</em></p>



<div id="ez-toc-container" class="ez-toc-v2_0_17_1 counter-hierarchy counter-decimal ez-toc-grey">
<div class="ez-toc-title-container">
<p class="ez-toc-title">Table of Contents</p>
<span class="ez-toc-title-toggle"></span>
</div>
<nav><ul class="ez-toc-list ez-toc-list-level-1">
<li class="ez-toc-page-1 ez-toc-heading-level-2"><a class="ez-toc-link ez-toc-heading-1" href="#Database_schema_change_process" title="Database schema change process">Database schema change process</a></li>
<li class="ez-toc-page-1 ez-toc-heading-level-2"><a class="ez-toc-link ez-toc-heading-2" href="#Example_-_Adding_a_new_table" title="Example &#8211; Adding a new table">Example &#8211; Adding a new table</a></li>
<li class="ez-toc-page-1 ez-toc-heading-level-2">
<a class="ez-toc-link ez-toc-heading-3" href="#Example_-_Incorrect_migration_leading_to_data_loss_and_how_to_fix_it" title="Example &#8211; Incorrect migration leading to data loss and how to fix it">Example &#8211; Incorrect migration leading to data loss and how to fix it</a><ul class="ez-toc-list-level-3"><li class="ez-toc-heading-level-3">
<a class="ez-toc-link ez-toc-heading-4" href="#To_prevent_data_loss_minimize_the_number_of_schema_changes_per_migration" title="To prevent data loss, minimize the number of schema changes per migration">To prevent data loss, minimize the number of schema changes per migration</a><ul class="ez-toc-list-level-4">
<li class="ez-toc-heading-level-4"><a class="ez-toc-link ez-toc-heading-5" href="#Small_migration_1" title="Small migration 1">Small migration 1</a></li>
<li class="ez-toc-page-1 ez-toc-heading-level-4"><a class="ez-toc-link ez-toc-heading-6" href="#Small_migration_2" title="Small migration 2">Small migration 2</a></li>
<li class="ez-toc-page-1 ez-toc-heading-level-4"><a class="ez-toc-link ez-toc-heading-7" href="#Apply_the_two_pending_migrations" title="Apply the two pending migrations">Apply the two pending migrations</a></li>
</ul>
</li></ul>
</li>
<li class="ez-toc-page-1 ez-toc-heading-level-2">
<a class="ez-toc-link ez-toc-heading-8" href="#What_happens_when_you_change_a_table_that_has_data" title="What happens when you change a table that has data?">What happens when you change a table that has data?</a><ul class="ez-toc-list-level-3">
<li class="ez-toc-heading-level-3">
<a class="ez-toc-link ez-toc-heading-9" href="#Changing_a_nullable_column_to_not_nullable" title="Changing a nullable column to not nullable">Changing a nullable column to not nullable</a><ul class="ez-toc-list-level-4"><li class="ez-toc-heading-level-4"><a class="ez-toc-link ez-toc-heading-10" href="#Example_of_how_to_make_a_nullable_not_allow_nulls" title="Example of how to make a nullable not allow nulls">Example of how to make a nullable not allow nulls</a></li></ul>
</li>
<li class="ez-toc-page-1 ez-toc-heading-level-3">
<a class="ez-toc-link ez-toc-heading-11" href="#Reducing_the_length_of_a_string_column" title="Reducing the length of a string column">Reducing the length of a string column</a><ul class="ez-toc-list-level-4"><li class="ez-toc-heading-level-4"><a class="ez-toc-link ez-toc-heading-12" href="#Example_of_reducing_the_length_of_a_string_column" title="Example of reducing the length of a string column">Example of reducing the length of a string column</a></li></ul>
</li>
</ul>
</li>
</ul></nav>
</div>
<h2 class="wp-block-heading">
<span class="ez-toc-section" id="Database_schema_change_process"></span>Database schema change process<span class="ez-toc-section-end"></span>
</h2>



<p>The following is the list of steps involved in the database schema change process:</p>



<ul class="wp-block-list">
<li>Make the schema change in the code.</li>



<li>Create a new migration.</li>



<li>Verify the correctness of the generated migration source code.</li>



<li>If there are problems with the migration:
<ul class="wp-block-list">
<li>Split schema changes into smaller migrations -OR- customize the migration to correct the problems.</li>
</ul>
</li>



<li>
<a href="/ef-core-apply-migrations-programmatically/" data-type="post" data-id="4476">Apply the migration programmatically</a> (or with the <em>dotnet ef</em> tool).</li>



<li>Verify correctness in the database.</li>
</ul>



<p>Now I&#8217;ll show examples of doing this process in various scenarios.</p>



<h2 class="wp-block-heading">
<span class="ez-toc-section" id="Example_-_Adding_a_new_table"></span>Example &#8211; Adding a new table<span class="ez-toc-section-end"></span>
</h2>



<p>Let&#8217;s say you want to add a new table called <em>Shows</em>.</p>



<p>First, add a new model class called <em>Show</em>:</p>


<pre class="wp-block-code" aria-describedby="shcb-language-1" data-shcb-language-name="C#" data-shcb-language-slug="cs"><span><code class="hljs language-cs shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span><span class="hljs-keyword">using</span> System.ComponentModel.DataAnnotations;
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Show</span>
</span></span><span class="shcb-loc"><span>{
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Key</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">MaxLength(500)</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">MaxLength(500)</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Description { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> NumberOfEpisodes { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> NumberOfSeasons { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>	
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> FirstYear { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>	
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span>? LastYear { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>}
</span></span></code></span><small class="shcb-language" id="shcb-language-1"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">C#</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">cs</span><span class="shcb-language__paren">)</span></small></pre>


<p>Then add a DbSet&lt;Show&gt; property to your DbContext class:</p>


<pre class="wp-block-code" aria-describedby="shcb-language-2" data-shcb-language-name="C#" data-shcb-language-slug="cs"><span><code class="hljs language-cs shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StreamingServiceContext</span> : <span class="hljs-title">DbContext</span>
</span></span><span class="shcb-loc"><span>{
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">string</span> ConnectionString;
</span></span><span class="shcb-loc"><span>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">StreamingServiceContext</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> connectionString</span>)</span>
</span></span><span class="shcb-loc"><span>	{
</span></span><span class="shcb-loc"><span>		ConnectionString = connectionString;
</span></span><span class="shcb-loc"><span>	}
</span></span><span class="shcb-loc"><span>	<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnConfiguring</span>(<span class="hljs-params">DbContextOptionsBuilder optionsBuilder</span>)</span>
</span></span><span class="shcb-loc"><span>	{
</span></span><span class="shcb-loc"><span>		optionsBuilder.UseSqlServer(ConnectionString);
</span></span><span class="shcb-loc"><span>	}
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> DbSet&lt;Movie&gt; Movies { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><mark class="shcb-loc"><span>	<span class="hljs-keyword">public</span> DbSet&lt;Show&gt; Shows { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></mark><span class="shcb-loc"><span>}
</span></span></code></span><small class="shcb-language" id="shcb-language-2"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">C#</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">cs</span><span class="shcb-language__paren">)</span></small></pre>


<p>Create the migration:</p>


<pre class="wp-block-code" aria-describedby="shcb-language-3" data-shcb-language-name="PowerShell" data-shcb-language-slug="powershell"><span><code class="hljs language-powershell shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span>dotnet ef migrations add Database_v1
</span></span></code></span><small class="shcb-language" id="shcb-language-3"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">PowerShell</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">powershell</span><span class="shcb-language__paren">)</span></small></pre>


<p>Take a look at the generated migration source code in <em>&lt;timestamp&gt;_Database_v1</em>.cs and verify correctness:</p>


<pre class="wp-block-code" aria-describedby="shcb-language-4" data-shcb-language-name="C#" data-shcb-language-slug="cs"><span><code class="hljs language-cs shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span><span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Database_v1</span> : <span class="hljs-title">Migration</span>
</span></span><span class="shcb-loc"><span>{
</span></span><span class="shcb-loc"><span>	<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Up</span>(<span class="hljs-params">MigrationBuilder migrationBuilder</span>)</span>
</span></span><span class="shcb-loc"><span>	{
</span></span><span class="shcb-loc"><span>		migrationBuilder.CreateTable(
</span></span><span class="shcb-loc"><span>			name: <span class="hljs-string">"Shows"</span>,
</span></span><span class="shcb-loc"><span>			columns: table =&gt; <span class="hljs-keyword">new</span>
</span></span><span class="shcb-loc"><span>			{
</span></span><span class="shcb-loc"><span>				Id = table.Column&lt;<span class="hljs-keyword">int</span>&gt;(type: <span class="hljs-string">"int"</span>, nullable: <span class="hljs-literal">false</span>)
</span></span><span class="shcb-loc"><span>					.Annotation(<span class="hljs-string">"SqlServer:Identity"</span>, <span class="hljs-string">"1, 1"</span>),
</span></span><span class="shcb-loc"><span>				Name = table.Column&lt;<span class="hljs-keyword">string</span>&gt;(type: <span class="hljs-string">"nvarchar(500)"</span>, maxLength: <span class="hljs-number">500</span>, nullable: <span class="hljs-literal">false</span>),
</span></span><span class="shcb-loc"><span>				Description = table.Column&lt;<span class="hljs-keyword">string</span>&gt;(type: <span class="hljs-string">"nvarchar(500)"</span>, maxLength: <span class="hljs-number">500</span>, nullable: <span class="hljs-literal">false</span>),
</span></span><span class="shcb-loc"><span>				NumberOfEpisodes = table.Column&lt;<span class="hljs-keyword">int</span>&gt;(type: <span class="hljs-string">"int"</span>, nullable: <span class="hljs-literal">false</span>),
</span></span><span class="shcb-loc"><span>				NumberOfSeasons = table.Column&lt;<span class="hljs-keyword">int</span>&gt;(type: <span class="hljs-string">"int"</span>, nullable: <span class="hljs-literal">false</span>),
</span></span><span class="shcb-loc"><span>				FirstYear = table.Column&lt;<span class="hljs-keyword">int</span>&gt;(type: <span class="hljs-string">"int"</span>, nullable: <span class="hljs-literal">false</span>),
</span></span><span class="shcb-loc"><span>				LastYear = table.Column&lt;<span class="hljs-keyword">int</span>&gt;(type: <span class="hljs-string">"int"</span>, nullable: <span class="hljs-literal">true</span>)
</span></span><span class="shcb-loc"><span>			},
</span></span><span class="shcb-loc"><span>			constraints: table =&gt;
</span></span><span class="shcb-loc"><span>			{
</span></span><span class="shcb-loc"><span>				table.PrimaryKey(<span class="hljs-string">"PK_Shows"</span>, x =&gt; x.Id);
</span></span><span class="shcb-loc"><span>			});
</span></span><span class="shcb-loc"><span>	}
</span></span><span class="shcb-loc"><span>	<span class="hljs-comment">//Down() not shown</span>
</span></span><span class="shcb-loc"><span>}
</span></span></code></span><small class="shcb-language" id="shcb-language-4"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">C#</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">cs</span><span class="shcb-language__paren">)</span></small></pre>


<p>It looks correct, so apply the migration:</p>


<pre class="wp-block-code" aria-describedby="shcb-language-5" data-shcb-language-name="PowerShell" data-shcb-language-slug="powershell"><span><code class="hljs language-powershell shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span>dotnot ef database update
</span></span></code></span><small class="shcb-language" id="shcb-language-5"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">PowerShell</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">powershell</span><span class="shcb-language__paren">)</span></small></pre>


<p>Now you&#8217;ll see the <em>Shows</em> table in the database. It&#8217;s a good idea to double-check the table definition in the database after the migration is applied.</p>



<h2 class="wp-block-heading">
<span class="ez-toc-section" id="Example_-_Incorrect_migration_leading_to_data_loss_and_how_to_fix_it"></span>Example &#8211; Incorrect migration leading to data loss and how to fix it<span class="ez-toc-section-end"></span>
</h2>



<p>Always check the generated migration source code. This cannot be repeated enough. The migration generator is not perfect, as I will show below. Therefore, it&#8217;s always necessary to double-check the migration code.</p>



<p>Let&#8217;s say you have a <em>Movies</em> table and want to apply the following schema changes:</p>



<ul class="wp-block-list">
<li>Column name change.</li>



<li>Add a new column.</li>



<li>Drop a column.</li>
</ul>



<p>Let&#8217;s see what happens if you try to apply all of these changes at the same time. </p>



<p>First, apply the schema changes to the <em>Movie</em> model:</p>


<pre class="wp-block-code" aria-describedby="shcb-language-6" data-shcb-language-name="C#" data-shcb-language-slug="cs"><span><code class="hljs language-cs shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Movie</span>
</span></span><span class="shcb-loc"><span>{
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Key</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">MaxLength(500)</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><mark class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> YearOfRelease { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } <span class="hljs-comment">//changed name</span>
</span></mark><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">MaxLength(500)</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Description { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><mark class="shcb-loc"><span>	<span class="hljs-comment">//dropped column</span>
</span></mark><mark class="shcb-loc"><span>	<span class="hljs-comment">//&#91;Required]</span>
</span></mark><mark class="shcb-loc"><span>	<span class="hljs-comment">//public int RuntimeMinutes { get; set; }</span>
</span></mark><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">MaxLength(100)</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Director { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><mark class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></mark><mark class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">decimal</span> BoxOfficeRevenue { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } <span class="hljs-comment">//added new column</span>
</span></mark><span class="shcb-loc"><span>}
</span></span></code></span><small class="shcb-language" id="shcb-language-6"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">C#</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">cs</span><span class="shcb-language__paren">)</span></small></pre>


<p>Then generate the migration:</p>


<pre class="wp-block-code" aria-describedby="shcb-language-7" data-shcb-language-name="PowerShell" data-shcb-language-slug="powershell"><span><code class="hljs language-powershell shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span>dotnet ef migrations add Database_v3
</span></span></code></span><small class="shcb-language" id="shcb-language-7"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">PowerShell</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">powershell</span><span class="shcb-language__paren">)</span></small></pre>


<p>You may notice the following warning (big red flag):</p>


<pre class="wp-block-code" aria-describedby="shcb-language-8" data-shcb-language-name="plaintext" data-shcb-language-slug="plaintext"><span><code class="hljs language-plaintext">An operation was scaffolded that may result in the loss of data. Please review the migration for accuracy.</code></span><small class="shcb-language" id="shcb-language-8"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">plaintext</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">plaintext</span><span class="shcb-language__paren">)</span></small></pre>


<p>Take a look at the generated migration source code in <em>&lt;timestamp&gt;_Database_v3.cs</em>, and pay close attention to the highlighted parts:</p>


<pre class="wp-block-code" aria-describedby="shcb-language-9" data-shcb-language-name="C#" data-shcb-language-slug="cs"><span><code class="hljs language-cs shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span><span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Database_v3</span> : <span class="hljs-title">Migration</span>
</span></span><span class="shcb-loc"><span>{
</span></span><span class="shcb-loc"><span>	<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Up</span>(<span class="hljs-params">MigrationBuilder migrationBuilder</span>)</span>
</span></span><span class="shcb-loc"><span>	{
</span></span><mark class="shcb-loc"><span>		migrationBuilder.DropColumn(
</span></mark><mark class="shcb-loc"><span>			name: <span class="hljs-string">"ReleaseYear"</span>,
</span></mark><mark class="shcb-loc"><span>			table: <span class="hljs-string">"Movies"</span>);
</span></mark><span class="shcb-loc"><span>
</span></span><mark class="shcb-loc"><span>		migrationBuilder.RenameColumn(
</span></mark><mark class="shcb-loc"><span>			name: <span class="hljs-string">"RuntimeMinutes"</span>,
</span></mark><mark class="shcb-loc"><span>			table: <span class="hljs-string">"Movies"</span>,
</span></mark><mark class="shcb-loc"><span>			newName: <span class="hljs-string">"YearOfRelease"</span>);
</span></mark><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>		migrationBuilder.AddColumn&lt;<span class="hljs-keyword">decimal</span>&gt;(
</span></span><span class="shcb-loc"><span>			name: <span class="hljs-string">"BoxOfficeRevenue"</span>,
</span></span><span class="shcb-loc"><span>			table: <span class="hljs-string">"Movies"</span>,
</span></span><span class="shcb-loc"><span>			type: <span class="hljs-string">"decimal(18,2)"</span>,
</span></span><span class="shcb-loc"><span>			nullable: <span class="hljs-literal">false</span>,
</span></span><span class="shcb-loc"><span>			defaultValue: <span class="hljs-number">0</span>m);
</span></span><span class="shcb-loc"><span>	}
</span></span><span class="shcb-loc"><span>	
</span></span><span class="shcb-loc"><span>	<span class="hljs-comment">//not showing Down()</span>
</span></span><span class="shcb-loc"><span>}
</span></span></code></span><small class="shcb-language" id="shcb-language-9"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">C#</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">cs</span><span class="shcb-language__paren">)</span></small></pre>


<p>It dropped the wrong column &#8211; <em>ReleaseYear </em>instead of <em>RuntimeMinutes </em>&#8211; and it renamed the wrong column &#8211; <em>RuntimeMinutes </em>instead of <em>ReleaseYear</em>.</p>



<p>Since the migration is wrong, remove it:</p>


<pre class="wp-block-code" aria-describedby="shcb-language-10" data-shcb-language-name="PowerShell" data-shcb-language-slug="powershell"><span><code class="hljs language-powershell shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span>dotnet ef migrations remove
</span></span></code></span><small class="shcb-language" id="shcb-language-10"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">PowerShell</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">powershell</span><span class="shcb-language__paren">)</span></small></pre>


<p>If your table had existing data in it, and you actually applied this migration, you&#8217;d have irreparable data loss. You&#8217;d end up with a column called <em>YearOfRelease </em>that has the <em>RuntimeMinutes</em> data in it. </p>



<p>This irreparable data loss may not be a big deal in a dev environment, but remember that you&#8217;ll eventually be applying the migration in a production environment. This is why you need to always double-check the generated migration code <em>before</em> applying it. </p>



<h3 class="wp-block-heading">
<span class="ez-toc-section" id="To_prevent_data_loss_minimize_the_number_of_schema_changes_per_migration"></span>To prevent data loss, minimize the number of schema changes per migration<span class="ez-toc-section-end"></span>
</h3>



<p>As shown above, generated migrations can be totally wrong and lead to data loss. </p>



<p>A simple solution is to create multiple, small migrations. Instead of trying to combine many schema changes into one migration, only include schema changes that can go together. You can figure out which changes can go together by trial and error.</p>



<p>The following example shows this approach.</p>



<h4 class="wp-block-heading">
<span class="ez-toc-section" id="Small_migration_1"></span><strong>Small migration 1</strong><span class="ez-toc-section-end"></span>
</h4>



<p>Let&#8217;s try to combine these two schema changes:</p>



<ul class="wp-block-list">
<li>Column name change.</li>



<li>Add a new column.</li>
</ul>



<p>First, make the changes in the <em>Movie</em> model:</p>


<pre class="wp-block-code" aria-describedby="shcb-language-11" data-shcb-language-name="C#" data-shcb-language-slug="cs"><span><code class="hljs language-cs shcb-code-table"><span class="shcb-loc"><span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Movie</span>
</span></span><span class="shcb-loc"><span>{
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Key</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">MaxLength(500)</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><mark class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></mark><mark class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> YearOfRelease { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } <span class="hljs-comment">//changed name</span>
</span></mark><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">MaxLength(500)</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Description { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> RuntimeMinutes { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">MaxLength(100)</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Director { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><mark class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></mark><mark class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">decimal</span> BoxOfficeRevenue { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } <span class="hljs-comment">//added new column</span>
</span></mark><span class="shcb-loc"><span>}
</span></span></code></span><small class="shcb-language" id="shcb-language-11"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">C#</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">cs</span><span class="shcb-language__paren">)</span></small></pre>


<p>Then generate the migration:</p>


<pre class="wp-block-code" aria-describedby="shcb-language-12" data-shcb-language-name="PowerShell" data-shcb-language-slug="powershell"><span><code class="hljs language-powershell shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span>dotnet ef migrations add Database_v3
</span></span></code></span><small class="shcb-language" id="shcb-language-12"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">PowerShell</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">powershell</span><span class="shcb-language__paren">)</span></small></pre>


<p>Take a look at the generated migration source code in <em>&lt;timestamp&gt;_Database_v3.cs</em>:</p>


<pre class="wp-block-code" aria-describedby="shcb-language-13" data-shcb-language-name="C#" data-shcb-language-slug="cs"><span><code class="hljs language-cs shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span><span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Database_v3</span> : <span class="hljs-title">Migration</span>
</span></span><span class="shcb-loc"><span>{
</span></span><span class="shcb-loc"><span>	<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Up</span>(<span class="hljs-params">MigrationBuilder migrationBuilder</span>)</span>
</span></span><span class="shcb-loc"><span>	{
</span></span><span class="shcb-loc"><span>		migrationBuilder.RenameColumn(
</span></span><span class="shcb-loc"><span>			name: <span class="hljs-string">"ReleaseYear"</span>,
</span></span><span class="shcb-loc"><span>			table: <span class="hljs-string">"Movies"</span>,
</span></span><span class="shcb-loc"><span>			newName: <span class="hljs-string">"YearOfRelease"</span>);
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>		migrationBuilder.AddColumn&lt;<span class="hljs-keyword">decimal</span>&gt;(
</span></span><span class="shcb-loc"><span>			name: <span class="hljs-string">"BoxOfficeRevenue"</span>,
</span></span><span class="shcb-loc"><span>			table: <span class="hljs-string">"Movies"</span>,
</span></span><span class="shcb-loc"><span>			type: <span class="hljs-string">"decimal(18,2)"</span>,
</span></span><span class="shcb-loc"><span>			nullable: <span class="hljs-literal">false</span>,
</span></span><span class="shcb-loc"><span>			defaultValue: <span class="hljs-number">0</span>m);
</span></span><span class="shcb-loc"><span>	}
</span></span><span class="shcb-loc"><span><span class="hljs-comment">//Down() not shown</span>
</span></span><span class="shcb-loc"><span>}
</span></span></code></span><small class="shcb-language" id="shcb-language-13"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">C#</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">cs</span><span class="shcb-language__paren">)</span></small></pre>


<p>This time the migration source code is correct. It&#8217;s renaming the <em>ReleaseYear</em> column to <em>YearOfRelease</em>, and adding the new <em>BoxOfficeRevenue</em> column.</p>



<h4 class="wp-block-heading">
<span class="ez-toc-section" id="Small_migration_2"></span><strong>Small migration 2</strong><span class="ez-toc-section-end"></span>
</h4>



<p>The remaining schema change we need to do is <em>Drop a column.</em></p>



<p>Apply this change in the <em>Movie</em> model:</p>


<pre class="wp-block-code" aria-describedby="shcb-language-14" data-shcb-language-name="C#" data-shcb-language-slug="cs"><span><code class="hljs language-cs shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Movie</span>
</span></span><span class="shcb-loc"><span>{
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Key</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">MaxLength(500)</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> YearOfRelease { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">MaxLength(500)</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Description { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	<span class="hljs-comment">//dropped column</span>
</span></span><span class="shcb-loc"><span>	<span class="hljs-comment">//&#91;Required]</span>
</span></span><span class="shcb-loc"><span>	<span class="hljs-comment">//public int RuntimeMinutes { get; set; }</span>
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">MaxLength(100)</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Director { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">decimal</span> BoxOfficeRevenue { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>}
</span></span></code></span><small class="shcb-language" id="shcb-language-14"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">C#</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">cs</span><span class="shcb-language__paren">)</span></small></pre>


<p>Then generate a new migration:</p>


<pre class="wp-block-code" aria-describedby="shcb-language-15" data-shcb-language-name="PowerShell" data-shcb-language-slug="powershell"><span><code class="hljs language-powershell shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span>dotnet ef migrations add Database_v4
</span></span></code></span><small class="shcb-language" id="shcb-language-15"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">PowerShell</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">powershell</span><span class="shcb-language__paren">)</span></small></pre>


<p>Take a look at the generated migration source code <em>&lt;timestamp&gt;_Database_v4.cs</em>:</p>


<pre class="wp-block-code" aria-describedby="shcb-language-16" data-shcb-language-name="C#" data-shcb-language-slug="cs"><span><code class="hljs language-cs shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span><span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Database_v4</span> : <span class="hljs-title">Migration</span>
</span></span><span class="shcb-loc"><span>{
</span></span><span class="shcb-loc"><span>	<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Up</span>(<span class="hljs-params">MigrationBuilder migrationBuilder</span>)</span>
</span></span><span class="shcb-loc"><span>	{
</span></span><span class="shcb-loc"><span>		migrationBuilder.DropColumn(
</span></span><span class="shcb-loc"><span>			name: <span class="hljs-string">"RuntimeMinutes"</span>,
</span></span><span class="shcb-loc"><span>			table: <span class="hljs-string">"Movies"</span>);
</span></span><span class="shcb-loc"><span>	}
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	<span class="hljs-comment">//Down() not shown</span>
</span></span><span class="shcb-loc"><span>}
</span></span></code></span><small class="shcb-language" id="shcb-language-16"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">C#</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">cs</span><span class="shcb-language__paren">)</span></small></pre>


<p>This is correct. It&#8217;s dropping the <em>RuntimeMinutes</em> column.</p>



<h4 class="wp-block-heading">
<span class="ez-toc-section" id="Apply_the_two_pending_migrations"></span><strong>Apply the two pending migrations</strong><span class="ez-toc-section-end"></span>
</h4>



<p>The two small migrations were created and verified for correctness. They are both pending migrations.</p>



<p>Take a look at the list of migrations:</p>


<pre class="wp-block-code" aria-describedby="shcb-language-17" data-shcb-language-name="PowerShell" data-shcb-language-slug="powershell"><span><code class="hljs language-powershell shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span>dotnet ef migrations list
</span></span></code></span><small class="shcb-language" id="shcb-language-17"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">PowerShell</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">powershell</span><span class="shcb-language__paren">)</span></small></pre>

<pre class="wp-block-code" aria-describedby="shcb-language-18" data-shcb-language-name="plaintext" data-shcb-language-slug="plaintext"><span><code class="hljs language-plaintext shcb-code-table"><span class="shcb-loc"><span>20210314133726_Database_v0
</span></span><span class="shcb-loc"><span>20210315113855_Database_v1
</span></span><span class="shcb-loc"><span>20210316112804_Database_v2
</span></span><mark class="shcb-loc"><span>20210316123742_Database_v3 (Pending)
</span></mark><mark class="shcb-loc"><span>20210316124316_Database_v4 (Pending)
</span></mark></code></span><small class="shcb-language" id="shcb-language-18"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">plaintext</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">plaintext</span><span class="shcb-language__paren">)</span></small></pre>


<p>Now apply the two pending migrations:</p>


<pre class="wp-block-code" aria-describedby="shcb-language-19" data-shcb-language-name="PowerShell" data-shcb-language-slug="powershell"><span><code class="hljs language-powershell shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span>dotnet ef database update
</span></span></code></span><small class="shcb-language" id="shcb-language-19"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">PowerShell</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">powershell</span><span class="shcb-language__paren">)</span></small></pre>


<p>Notice that this applied both migrations</p>


<pre class="wp-block-code" aria-describedby="shcb-language-20" data-shcb-language-name="plaintext" data-shcb-language-slug="plaintext"><span><code class="hljs language-plaintext">Applying migration '20210316123742_Database_v3'.
Applying migration '20210316124316_Database_v4'.</code></span><small class="shcb-language" id="shcb-language-20"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">plaintext</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">plaintext</span><span class="shcb-language__paren">)</span></small></pre>


<p>Because the schema changes were done separately, the generated migrations were correct, and there was no data loss.</p>



<h2 class="wp-block-heading">
<span class="ez-toc-section" id="What_happens_when_you_change_a_table_that_has_data"></span>What happens when you change a table that has data?<span class="ez-toc-section-end"></span>
</h2>



<p>There are many different schema changes you can do. Most of them can be applied to tables with existing data without problems. Don&#8217;t risk it though &#8211; always test your migrations in a dev environment against tables that have data in them. </p>



<p>With that said, there are some schema changes that will fail to apply to a table with data in them. When you run into this situation, you may be able to customize the migration to solve the problem. I&#8217;ll show two examples of this below.</p>



<h3 class="wp-block-heading">
<span class="ez-toc-section" id="Changing_a_nullable_column_to_not_nullable"></span>Changing a nullable column to not nullable<span class="ez-toc-section-end"></span>
</h3>



<p>When you try to change a nullable column to not allow nulls, and the table already has NULL values in that column, then the generated migration won&#8217;t handle it properly. You&#8217;ll run into this error:</p>



<blockquote class="wp-block-quote is-layout-flow wp-block-quote-is-layout-flow">
<p>Cannot insert the value NULL into column &#8216;Director&#8217;, table &#8216;StreamingService.dbo.Movies&#8217;; column does not allow nulls. UPDATE fails.</p>
</blockquote>



<p>To solve this problem, you can customize the migration by updating nulls to a default value before it does the column change. I&#8217;ll show a full example of this scenario below.</p>



<h4 class="wp-block-heading">
<span class="ez-toc-section" id="Example_of_how_to_make_a_nullable_not_allow_nulls"></span><strong>Example of how to make a nullable not allow nulls</strong><span class="ez-toc-section-end"></span>
</h4>



<p>The <em>Director </em>column is currently nullable. To make it not nullable, add the [Required] attribute:</p>


<pre class="wp-block-code" aria-describedby="shcb-language-21" data-shcb-language-name="C#" data-shcb-language-slug="cs"><span><code class="hljs language-cs shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Movie</span>
</span></span><span class="shcb-loc"><span>{
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Key</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">MaxLength(500)</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> YearOfRelease { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">MaxLength(500)</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Description { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><mark class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>] <span class="hljs-comment">//required = doesn't allow nulls</span>
</span></mark><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">MaxLength(100)</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Director { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">decimal</span> BoxOfficeRevenue { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>}
</span></span></code></span><small class="shcb-language" id="shcb-language-21"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">C#</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">cs</span><span class="shcb-language__paren">)</span></small></pre>


<p>Create the migration for this change:</p>


<pre class="wp-block-code" aria-describedby="shcb-language-22" data-shcb-language-name="PowerShell" data-shcb-language-slug="powershell"><span><code class="hljs language-powershell shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span>dotnet ef migrations add Database_v5
</span></span></code></span><small class="shcb-language" id="shcb-language-22"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">PowerShell</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">powershell</span><span class="shcb-language__paren">)</span></small></pre>


<p>Take a look at the generated migration source code in <em>&lt;timestamp&gt;_Database_v5.cs</em> and customize it by executing an UPDATE statement with migrationBuilder.Sql(): </p>


<pre class="wp-block-code" aria-describedby="shcb-language-23" data-shcb-language-name="C#" data-shcb-language-slug="cs"><span><code class="hljs language-cs shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span><span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Database_v5</span> : <span class="hljs-title">Migration</span>
</span></span><span class="shcb-loc"><span>{
</span></span><span class="shcb-loc"><span>	<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Up</span>(<span class="hljs-params">MigrationBuilder migrationBuilder</span>)</span>
</span></span><span class="shcb-loc"><span>	{
</span></span><mark class="shcb-loc"><span>		migrationBuilder.Sql(<span class="hljs-string">@"UPDATE Movies SET Director = '' WHERE Director IS NULL"</span>);
</span></mark><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>		migrationBuilder.AlterColumn&lt;<span class="hljs-keyword">string</span>&gt;(
</span></span><span class="shcb-loc"><span>			name: <span class="hljs-string">"Director"</span>,
</span></span><span class="shcb-loc"><span>			table: <span class="hljs-string">"Movies"</span>,
</span></span><span class="shcb-loc"><span>			type: <span class="hljs-string">"nvarchar(100)"</span>,
</span></span><span class="shcb-loc"><span>			maxLength: <span class="hljs-number">100</span>,
</span></span><span class="shcb-loc"><span>			nullable: <span class="hljs-literal">false</span>,
</span></span><span class="shcb-loc"><span>			defaultValue: <span class="hljs-string">""</span>,
</span></span><span class="shcb-loc"><span>			oldClrType: <span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">string</span>),
</span></span><span class="shcb-loc"><span>			oldType: <span class="hljs-string">"nvarchar(100)"</span>,
</span></span><span class="shcb-loc"><span>			oldMaxLength: <span class="hljs-number">100</span>,
</span></span><span class="shcb-loc"><span>			oldNullable: <span class="hljs-literal">true</span>);
</span></span><span class="shcb-loc"><span>	}
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	<span class="hljs-comment">//Down() not shown</span>
</span></span><span class="shcb-loc"><span>}
</span></span></code></span><small class="shcb-language" id="shcb-language-23"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">C#</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">cs</span><span class="shcb-language__paren">)</span></small></pre>


<p>Apply the migration:</p>


<pre class="wp-block-code" aria-describedby="shcb-language-24" data-shcb-language-name="PowerShell" data-shcb-language-slug="powershell"><span><code class="hljs language-powershell shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span>dotnet ef database update
</span></span></code></span><small class="shcb-language" id="shcb-language-24"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">PowerShell</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">powershell</span><span class="shcb-language__paren">)</span></small></pre>


<p>This was able to apply the migration without problems, because it replaced all nulls with empty strings, and then changed the column to not allow nulls.</p>



<h3 class="wp-block-heading">
<span class="ez-toc-section" id="Reducing_the_length_of_a_string_column"></span>Reducing the length of a string column<span class="ez-toc-section-end"></span>
</h3>



<p>Let&#8217;s say you have existing strings that are 50 characters long, and you want to change the maximum length of this string column to 40 characters. When you try to apply this schema change, you&#8217;ll run into the following error:</p>



<blockquote class="wp-block-quote is-layout-flow wp-block-quote-is-layout-flow">
<p>String or binary data would be truncated.</p>
</blockquote>



<p>First, make sure you&#8217;re OK with truncating the existing data in the table.</p>



<p>You can solve this problem by customizing the migration to truncate the string column before it does the column change.</p>



<p><em>Disclaimer: Doing this will result in data loss because you&#8217;ll be intentionally truncating the string column. Don&#8217;t do this if you don&#8217;t want to lose data.</em></p>



<h4 class="wp-block-heading">
<span class="ez-toc-section" id="Example_of_reducing_the_length_of_a_string_column"></span><strong>Example of reducing the length of a string column</strong><span class="ez-toc-section-end"></span>
</h4>



<p>First, change the [MaxLength] attribute for the <em>Description</em> column:</p>


<pre class="wp-block-code" aria-describedby="shcb-language-25" data-shcb-language-name="C#" data-shcb-language-slug="cs"><span><code class="hljs language-cs shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Movie</span>
</span></span><span class="shcb-loc"><span>{
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Key</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">MaxLength(500)</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> YearOfRelease { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><mark class="shcb-loc"><span>	&#91;<span class="hljs-meta">MaxLength(30)</span>] <span class="hljs-comment">//reduced from 500 to 30</span>
</span></mark><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Description { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">MaxLength(100)</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Director { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	&#91;<span class="hljs-meta">Required</span>]
</span></span><span class="shcb-loc"><span>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">decimal</span> BoxOfficeRevenue { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</span></span><span class="shcb-loc"><span>}
</span></span></code></span><small class="shcb-language" id="shcb-language-25"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">C#</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">cs</span><span class="shcb-language__paren">)</span></small></pre>


<p>Then create a new migration:</p>


<pre class="wp-block-code"><span><code class="hljs">dotnet ef migrations add Database_v6</code></span></pre>


<p>Now take a look at the generated migration source code in <em>&lt;timestamp&gt;_Database_v6.c</em>s and customize it by executing an UPDATE statement with migrationBuilder.Sql():</p>


<pre class="wp-block-code" aria-describedby="shcb-language-26" data-shcb-language-name="C#" data-shcb-language-slug="cs"><span><code class="hljs language-cs shcb-code-table shcb-line-numbers shcb-wrap-lines"><span class="shcb-loc"><span><span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Database_v6</span> : <span class="hljs-title">Migration</span>
</span></span><span class="shcb-loc"><span>{
</span></span><span class="shcb-loc"><span>	<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Up</span>(<span class="hljs-params">MigrationBuilder migrationBuilder</span>)</span>
</span></span><span class="shcb-loc"><span>	{
</span></span><mark class="shcb-loc"><span>		migrationBuilder.Sql(<span class="hljs-string">@"UPDATE Movies SET Description = LEFT(Description, 30) WHERE LEN(Description) &gt; 30"</span>);
</span></mark><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>		migrationBuilder.AlterColumn&lt;<span class="hljs-keyword">string</span>&gt;(
</span></span><span class="shcb-loc"><span>			name: <span class="hljs-string">"Description"</span>,
</span></span><span class="shcb-loc"><span>			table: <span class="hljs-string">"Movies"</span>,
</span></span><span class="shcb-loc"><span>			type: <span class="hljs-string">"nvarchar(30)"</span>,
</span></span><span class="shcb-loc"><span>			maxLength: <span class="hljs-number">30</span>,
</span></span><span class="shcb-loc"><span>			nullable: <span class="hljs-literal">false</span>,
</span></span><span class="shcb-loc"><span>			oldClrType: <span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">string</span>),
</span></span><span class="shcb-loc"><span>			oldType: <span class="hljs-string">"nvarchar(500)"</span>,
</span></span><span class="shcb-loc"><span>			oldMaxLength: <span class="hljs-number">500</span>);
</span></span><span class="shcb-loc"><span>	}
</span></span><span class="shcb-loc"><span>
</span></span><span class="shcb-loc"><span>	<span class="hljs-comment">//Down() not shown</span>
</span></span><span class="shcb-loc"><span>}
</span></span></code></span><small class="shcb-language" id="shcb-language-26"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">C#</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">cs</span><span class="shcb-language__paren">)</span></small></pre>


<p>Apply the migration:</p>


<pre class="wp-block-code" aria-describedby="shcb-language-27" data-shcb-language-name="PowerShell" data-shcb-language-slug="powershell"><span><code class="hljs language-powershell shcb-code-table shcb-line-numbers"><span class="shcb-loc"><span>dotnet ef database update
</span></span></code></span><small class="shcb-language" id="shcb-language-27"><span class="shcb-language__label">Code language:</span> <span class="shcb-language__name">PowerShell</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">powershell</span><span class="shcb-language__paren">)</span></small></pre>


<p>This successfully applied the migration by first truncating the string column to the reduced length, then it changed the length of the column.</p>
<div class="related_content" style="clear:both;">
<h3 class="widget-title">Related Articles</h3>
									<ul class="related-posts">
										<li class="related-post">
											<a href="/ef-core-how-to-create-a-database-and-a-table/">EF Core &#8211; How to create a database and a table</a>
										</li>
										<li class="related-post">
											<a href="/ef-core-apply-migrations-programmatically/">EF Core &#8211; Apply migrations programmatically</a>
										</li>
										<li class="related-post">
											<a href="/ef-core-inheritance-mapping/">EF Core &#8211; Inheritance mapping</a>
										</li>
										<li class="related-post">
											<a href="/ef-core-how-to-add-indexes/">EF Core &#8211; How to add indexes</a>
										</li>
										<li class="related-post">
											<a href="/ef-core-how-to-add-a-computed-column/">EF Core &#8211; How to add a computed column</a>
										</li>
									</ul>
									<div style="clear:both;"></div>
</div>
							</div>

				<footer class="entry-meta" aria-label="Entry meta">
			<span class="cat-links"><span class="gp-icon icon-categories"><svg viewbox="0 0 512 512" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M0 112c0-26.51 21.49-48 48-48h110.014a48 48 0 0143.592 27.907l12.349 26.791A16 16 0 00228.486 128H464c26.51 0 48 21.49 48 48v224c0 26.51-21.49 48-48 48H48c-26.51 0-48-21.49-48-48V112z"></path></svg></span><span class="screen-reader-text">Categories </span><a href="/category/csharp/" rel="category tag">C#</a></span> <span class="tags-links"><span class="gp-icon icon-tags"><svg viewbox="0 0 512 512" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M20 39.5c-8.836 0-16 7.163-16 16v176c0 4.243 1.686 8.313 4.687 11.314l224 224c6.248 6.248 16.378 6.248 22.626 0l176-176c6.244-6.244 6.25-16.364.013-22.615l-223.5-224A15.999 15.999 0 00196.5 39.5H20zm56 96c0-13.255 10.745-24 24-24s24 10.745 24 24-10.745 24-24 24-24-10.745-24-24z"></path><path d="M259.515 43.015c4.686-4.687 12.284-4.687 16.97 0l228 228c4.686 4.686 4.686 12.284 0 16.97l-180 180c-4.686 4.687-12.284 4.687-16.97 0-4.686-4.686-4.686-12.284 0-16.97L479.029 279.5 259.515 59.985c-4.686-4.686-4.686-12.284 0-16.97z"></path></svg></span><span class="screen-reader-text">Tags </span><a href="/tag/dbcontext/" rel="tag">dbcontext</a>, <a href="/tag/dbset/" rel="tag">dbset</a>, <a href="/tag/efcore/" rel="tag">efcore</a></span> 		<nav id="nav-below" class="post-navigation" aria-label="Posts">
			<div class="nav-previous">
<span class="gp-icon icon-arrow-left"><svg viewbox="0 0 192 512" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M178.425 138.212c0 2.265-1.133 4.813-2.832 6.512L64.276 256.001l111.317 111.277c1.7 1.7 2.832 4.247 2.832 6.513 0 2.265-1.133 4.813-2.832 6.512L161.43 394.46c-1.7 1.7-4.249 2.832-6.514 2.832-2.266 0-4.816-1.133-6.515-2.832L16.407 262.514c-1.699-1.7-2.832-4.248-2.832-6.513 0-2.265 1.133-4.813 2.832-6.512l131.994-131.947c1.7-1.699 4.249-2.831 6.515-2.831 2.265 0 4.815 1.132 6.514 2.831l14.163 14.157c1.7 1.7 2.832 3.965 2.832 6.513z" fill-rule="nonzero"></path></svg></span><span class="prev"><a href="/ef-core-how-to-create-a-database-and-a-table/" rel="prev">EF Core &#8211; How to create a database and a table</a></span>
</div>
<div class="nav-next">
<span class="gp-icon icon-arrow-right"><svg viewbox="0 0 192 512" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M178.425 256.001c0 2.266-1.133 4.815-2.832 6.515L43.599 394.509c-1.7 1.7-4.248 2.833-6.514 2.833s-4.816-1.133-6.515-2.833l-14.163-14.162c-1.699-1.7-2.832-3.966-2.832-6.515 0-2.266 1.133-4.815 2.832-6.515l111.317-111.316L16.407 144.685c-1.699-1.7-2.832-4.249-2.832-6.515s1.133-4.815 2.832-6.515l14.163-14.162c1.7-1.7 4.249-2.833 6.515-2.833s4.815 1.133 6.514 2.833l131.994 131.993c1.7 1.7 2.832 4.249 2.832 6.515z" fill-rule="nonzero"></path></svg></span><span class="next"><a href="/ef-core-apply-migrations-programmatically/" rel="next">EF Core &#8211; Apply migrations programmatically</a></span>
</div>		</nav>
				</footer>
			</div>
</article>

			<div class="comments-area">
				<div id="comments">

	<h3 class="comments-title">2 thoughts on &ldquo;EF Core &#8211; Database schema changes&rdquo;</h3>
		<ol class="comment-list">
			
		<li id="comment-13231" class="comment even thread-even depth-1 parent">
			<article class="comment-body" id="div-comment-13231" itemtype="https://schema.org/Comment" itemscope>
				<footer class="comment-meta" aria-label="Comment meta">
										<div class="comment-author-info">
						<div class="comment-author vcard" itemprop="author" itemtype="https://schema.org/Person" itemscope>
							<cite itemprop="name" class="fn">Pieterjan</cite>						</div>

													<div class="entry-meta comment-metadata">
								<a href="/ef-core-database-schema-changes/#comment-13231">									<time datetime="2021-12-06T09:00:50-05:00" itemprop="datePublished">
										12/06/2021 at 9:00 am									</time>
								</a>							</div>
												</div>

									</footer>

				<div class="comment-content" itemprop="text">
					<p>Hi. How do you migrate your database model from TPH (as in EF Core 3.1) to TPT (as in EF Core 6) where data from columns must be transferred to the child entity table columns?</p>
				</div>
			</article>
			<ul class="children">

		<li id="comment-13243" class="comment byuser comment-author-mak bypostauthor odd alt depth-2">
			<article class="comment-body" id="div-comment-13243" itemtype="https://schema.org/Comment" itemscope>
				<footer class="comment-meta" aria-label="Comment meta">
										<div class="comment-author-info">
						<div class="comment-author vcard" itemprop="author" itemtype="https://schema.org/Person" itemscope>
							<cite itemprop="name" class="fn">Maclain Wiltzer</cite>						</div>

													<div class="entry-meta comment-metadata">
								<a href="/ef-core-database-schema-changes/#comment-13243">									<time datetime="2021-12-06T17:24:00-05:00" itemprop="datePublished">
										12/06/2021 at 5:24 pm									</time>
								</a>							</div>
												</div>

									</footer>

				<div class="comment-content" itemprop="text">
					<p>Hi Pieterjan,</p>
<p><strong>Concrete example data and definition</strong><br>
Let&#8217;s start by defining a concrete example.<br>
1. public class abstract People { Id, Name }<br>
2. public class Programmer : People { Language }<br>
3. public class Driver : People { Car }</p>
<p>Let&#8217;s add some sample data. Let&#8217;s say we have two people:<br>
1. Programmer { Id = 1, Name = &#8220;Bob&#8221;, Language = &#8220;C#&#8221; }<br>
2. Driver { Id = 2 Name = &#8220;Alice&#8221;, Car = &#8220;Honda&#8221; }</p>
<p>Using the Table-per-Hierarchy (TPH) inheritance approach, we have a single table that has base class columns + subclass columns + a discriminator field (implicit):<br>
Id, Name, Discriminator, Language, Car<br>
1, Bob, Programmer, C#, null<br>
2, Alice, Driver, null, Honda</p>
<p>You want to convert this to use the Table-per-Type (TPT) inheritance approach. In this approach, we&#8217;ll have three tables: People, Programmers, and Drivers.<br>
table People<br>
Id, Name<br>
1, Bob<br>
2, Alice</p>
<p>table Programmers<br>
FK Id, Language<br>
1, C#</p>
<p>table Drivers<br>
FK Id, Car<br>
2, Honda</p>
<p>Now that we have a concrete example, and understand what the database looks right now (TPH) and what we want it to look like (TPT), we can do the migration step by step using the approach outlined in this article.</p>
<p><strong>Step 1 &#8211; Make the schema change in the code</strong></p>
<p>We need to convert to the TPT inheritance style. One way to do that is in the context.OnModelCreating():<br>
<code>protected override void OnModelCreating(ModelBuilder modelBuilder)<br>
{<br>
	modelBuilder.Entity&lt;People&gt;().ToTable("People");<br>
	modelBuilder.Entity&lt;Programmer&gt;().ToTable("Programmers");<br>
	modelBuilder.Entity&lt;Driver&gt;().ToTable("Drivers");<br>
}</code></p>
<p><strong>Step 2 &#8211; Create a new migration</strong><br>
Execute the command to create a new migration: dotnet ef migrations add Convert_To_TPT</p>
<p>This will generate a migration file like: /Migrations/20211206215242_Convert_To_TPT.cs</p>
<p><strong>Step 3 &#8211; Look at the generated migration file and modify it</strong><br>
The generated migration file will definitely be wrong. The migrate Up() method will be doing the following:<br>
1. Drop the Programmer + Driver columns from the People table<br>
2. Create the Driver table<br>
3. Create the Programmer table</p>
<p>We can use this as a starting point and modify it. Here&#8217;s what we need to do:<br>
1. Create the Driver table (existing &#8211; move up)<br>
2. Create the Programmer table (existing &#8211; move up)<br>
3. Copy data from the People table to the Driver table (new &#8211; manual SQL)</p>
<p><code>migrationBuilder.Sql(@"INSERT INTO Drivers (Id, Car) SELECT Id, Car FROM People WHERE Discriminator='Driver'");</code></p>
<p>4. Copy data from the People table to the Programmer table (new &#8211; manual SQL)</p>
<p><code>migrationBuilder.Sql(@"INSERT INTO Programmers (Id, Language) SELECT Id, Language FROM People WHERE Discriminator='Programmer'");</code></p>
<p>5. Drop the subclass columns from the People table (existing &#8211; move down)</p>
<p><strong>Step 4 &#8211; Apply the migration</strong><br>
<em>Warning: Be sure to try this is a test/dev environment first so you can verify correctness without the risk of losing production data</em></p>
<p>Execute the command to apply the migration: dotnet ef database update</p>
<p>The migration runs in a SQL transaction, so if there are any problems, it&#8217;ll roll back. If there&#8217;s no problems with applying the migration, go to the next step.</p>
<p><strong>Step 5 &#8211; Verify correctness in the database</strong></p>
<p>Look at the database to verify correctness. I see the following:<br>
table People<br>
Id, Name<br>
1, Bob<br>
2, Alice</p>
<p>table Programmers<br>
FK Id, Language<br>
1, C#</p>
<p>table Drivers<br>
FK Id, Car<br>
2, Honda</p>
<p>This matches our desired outcome (mentioned at the top), so the migration is correct.</p>
<p>This is a simplified example. If you run into problems while implementing the actual migration, feel free to let me know if you want help.</p>
<p>NOTE: If you need to support undoing migrations, implement Down() as well. It will basically be TPT-to-TPH, which is undoing what migrate Up() is doing here. I&#8217;ll leave that as an exercise for the reader.</p>
				</div>
			</article>
			</li>
<!-- #comment-## -->
</ul>
<!-- .children -->
</li>
<!-- #comment-## -->
		</ol>
<!-- .comment-list -->

			
	
</div>
<!-- #comments -->
			</div>

					</main>
	</div>

	<div class="widget-area sidebar is-right-sidebar grid-25 tablet-grid-25 grid-parent" id="right-sidebar">
	<div class="inside-right-sidebar">
		<aside id="block-19" class="widget inner-padding widget_block"><div></div></aside>	</div>
</div>

	</div>
</div>


<div class="site-footer footer-bar-active footer-bar-align-right">
			<footer class="site-info" aria-label="Site" itemtype="https://schema.org/WPFooter" itemscope>
			<div class="inside-site-info grid-container grid-parent">
						<div class="footer-bar">
			<aside id="block-11" class="widget inner-padding widget_block"></aside><aside id="block-7" class="widget inner-padding widget_block"><a href="/about/">About</a> ‚Ä¢ <a href="/privacy-policy/">Privacy Policy</a></aside>		</div>
						<div class="copyright-bar">
					<span class="copyright">&copy; 2025 makolyte</span></div>
			</div>
		</footer>
		</div>

<script id="generate-a11y">!function(){"use strict";if("querySelector"in document&&"addEventListener"in window){var e=document.body;e.addEventListener("mousedown",function(){e.classList.add("using-mouse")}),e.addEventListener("keydown",function(){e.classList.remove("using-mouse")})}}();</script><!--[if lte IE 11]>
<script src="/wp-content/themes/generatepress/assets/js/classList.min.js?ver=3.3.1" id="generate-classlist-js"></script>
<![endif]-->
<script id="generate-menu-js-extra">var generatepressMenu = {"toggleOpenedSubMenus":"1","openSubMenuLabel":"Open Sub-Menu","closeSubMenuLabel":"Close Sub-Menu"};</script>
<script src="/wp-content/themes/generatepress/assets/js/menu.min.js?ver=3.3.1" id="generate-menu-js"></script>
<script id="generate-navigation-search-js-extra">var generatepressNavSearch = {"open":"Open Search Bar","close":"Close Search Bar"};</script>
<script src="/wp-content/themes/generatepress/assets/js/navigation-search.min.js?ver=3.3.1" id="generate-navigation-search-js"></script>
<script src="/wp-includes/js/comment-reply.min.js?ver=6.7.2" id="comment-reply-js" async data-wp-strategy="async"></script>

</body>


<!-- plugin=object-cache-pro client=phpredis metric#hits=1356 metric#misses=60 metric#hit-ratio=95.8 metric#bytes=754927 metric#prefetches=0 metric#store-reads=115 metric#store-writes=34 metric#store-hits=68 metric#store-misses=56 metric#sql-queries=18 metric#ms-total=1557.16 metric#ms-cache=187.11 metric#ms-cache-avg=1.2642 metric#ms-cache-ratio=12.0 sample#redis-hits=11064453 sample#redis-misses=5702460 sample#redis-hit-ratio=66.0 sample#redis-ops-per-sec=106 sample#redis-evicted-keys=0 sample#redis-used-memory=42627536 sample#redis-used-memory-rss=25870336 sample#redis-memory-fragmentation-ratio=0.6 sample#redis-connected-clients=4 sample#redis-tracking-clients=0 sample#redis-rejected-connections=0 sample#redis-keys=81450 -->
</html>